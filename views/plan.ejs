<%- include('partials/header') %>
<div class="flex-1 ml-40 bg-slate-200 h-screen" id="page">
    <div class="bg-emerald-400 p-8 flex justify-between ">
        <h1 class="text-3xl text-white font-semibold ">Plans</h1>
        <button onclick="handleAddPlan()" class="border-2  rounded-md border-slate-900 hover:scale-105 font-bold px-2 py-1"> Add New Plan</button>
    </div>
    <div class="ml-4 m-4 grid grid-cols-3 gap-3 bg-white p-4 rounded-2xl ">
        <div class="flex items-center p-2 ">
            <p class="text-md bg-slate-900 text-white px-2 py-1 border-2 border-slate-900 rounded-l-md  -mr-1 ">Plan Name
            </p>
            <input class="border-slate-900 border-2  px-2 py-1 focus:outline-none rounded-r-md " type="text"
                id="myinput" onkeyup="searchFun()" placeholder="xxx*yyy" />
        </div>
        <div class="flex items-center p-2 ">
            <p class="text-md bg-slate-900 text-white px-2 py-1 border-2 border-slate-900 rounded-l-md  h-10 -mr-1 ">
                Type</p>
            <select class=" border-slate-900 border-2 px-2 py-1  focus:outline-none rounded-r-md h-10 " id="myinput">
                <optgroup>
                    <option value="free">Group</option>
                    <option value="pro">Pro</option>
                    <option value="pro-plus">Pro-Plus</option>
                </optgroup>
            </select>
        </div>
        <div class="p-2">
            <button class="hover:cursor-pointer px-4 hover:scale-105 py-1 bg-emerald-400 rounded-md  text-lg ">Search <i
                    class="fa-solid fa-search text-sm ml-1"></i> </button>
        </div>
    </div>
    <div class="bg-white p-4 m-4 rounded-2xl">
        <div class="p-2">
            <p class="text-slate-900 font-semibold mb-2 underline decoration-emerald-400">Plan List</p>
        </div>
        <table class="table" id="mytable">
            <thead class="">
                <tr>
                    <th scope="col">#</th>
                    <th scope="col">Name</th>
                    <th scope="col">Price</th>
                    <th scope="col">Period</th>
                    <th scope="col">Plan_ID</th>
                </tr>
            </thead>
            <tbody class="">
                <% locals.data.forEach(element=>{ %> 
                <tr>
                    <td scope="row">1</td>
                    <td scope="" class="capitalize"> <%= element.plan_name%></td>
                    <td scope="" class="capitalize"><%= element.plan_rate%></td>
                    <td class="capitalize"><%= element.plan_period %> </td>
                    <td class="capitalize"><%= element.razorpay_plan_id%>  </td>
                </tr>
                <% }); %> 
            </tbody>
        </table>
    </div>
</div>
<div class="m-auto absolute left-0 right-0 top-20 bottom-0 w-1/2 drop-shadow-2xl hidden " id="add-plan">
    <div class="bg-white rounded-2xl relative">
        <div class="text-slate-900 absolute top-1 right-4 z-20" onclick="handleAddUserCrossClick(this)">
            <i class="fa-solid fa-xmark text-3xl cursor-pointer hover:scale-105"></i>
        </div>
        <div class="relative" >
            <div class="px-4 py-2 font-bold text-white rounded-t-2xl bg-emerald-400 text-xl"><span>Add New Plan</span></div>
            <div class="mt-4 p-2">
                <form id="add-plan-form" onsubmit="onPlanSubmit()">
                    <div class="grid grid-cols-1 gap-1 px-6 justify-center">
                        <div class="flex items-center p-2">
                            <span
                                class="px-2 py-1 bg-slate-900 border-2 border-slate-900 rounded-l-lg text-white">Name
                            </span>
                            <input type="text" name="plan-name" placeholder="New Plan"
                                class="border-2 border-slate-900 px-2 py-1 rounded-r-lg focus:outline-none w-full"
                                required>
                        </div>
                        <div class="flex items-center p-2">
                            <span
                                class="px-2 py-1 bg-slate-900 border-2 border-slate-900 rounded-l-lg text-white">Amount
                            </span>
                            <input type="number" name="amount" placeholder="1200"
                                class="border-2 border-slate-900 px-2 py-1 rounded-r-lg focus:outline-none w-full"
                                required>
                        </div>
                        <div class="flex justify-between">
                            <div class="flex items-center p-2">
                                <span
                                    class="px-2 py-1 bg-slate-900 border-2 border-slate-900 rounded-l-lg text-white h-10">Period
                                </span>
                                <select name="period" class="border-2 border-slate-900 py-2 rounded-r-lg focus:outline-none px-2 h-10">
                                    <option value="monthly">Monthly</option>
                                    <option value="yearly">Yearly</option>
                                   </select>
                            </div>
                            <div class="flex items-center p-2">
                                <span
                                    class="px-2 py-1 bg-slate-900 border-2 border-slate-900 rounded-l-lg  text-white h-10">Plan
                                </span>
                               <select name="plan-type" class="border-2 border-slate-900 py-2 rounded-r-lg focus:outline-none px-2 h-10">
                                <option value="pro">Pro</option>
                                <option value="plus">Pro-Plus</option>
                                <option value="group">Group</option>
                               </select>
                            </div>
                        </div>
                        <div class="flex items-center p-2">
                            <span
                                class="px-2 py-1 bg-slate-900 border-2 border-slate-900 rounded-l-lg text-white">Currency
                            </span>
                            <input type="text" name="currency" value="INR"
                                class="border-2 border-slate-900 px-2 py-1 rounded-r-lg focus:outline-none w-full"
                                readonly>
                        </div>
                        <div class="flex items-center p-2">
                            <span
                                class="px-2 py-1 bg-slate-900 border-2 border-slate-900 rounded-l-lg text-white">Interval
                            </span>
                            <input type="number" name="interval" value="1"
                                class="border-2 border-slate-900 px-2 py-1 rounded-r-lg focus:outline-none w-full"
                                readonly>
                        </div>
                        <div class="row-span-1 p-2">
                            <button type="submit" class="px-4 py-2 bg-emerald-400 hover:scale-105 text-white font-semibold rounded-lg focus:scale-105">Submit</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
<div class="m-auto absolute left-0 right-0 top-1/3 bottom-0 w-3/6 drop-shadow-2xl hidden" id="response">
    <div class="bg-white rounded-2xl relative">
        <div class="text-slate-900 absolute top-1 right-4 z-20" onclick="handleStatusCrossClick(this)">
            <i class="fa-solid fa-xmark  text-3xl hover:cursor-pointer "></i>
        </div>
        <div class="relative">
            <div class="mt-4 p-2">
                    <div class="flex flex-col ">
                        <div class="flex items-center p-2 ">
                            <input type="text" name="response" 
                                class="border-0 p-4 text-2xl focus:outline-none w-4/6" readonly>
                        </div>
                    </div>
            </div>
        </div>
    </div>
</div>
<script>

    $("#plans").addClass('bg-emerald-400');
    const searchFun = () => {
             let filter = document.getElementById('title').value.toLowerCase();
             let mytable = document.getElementById('mytable');
             let tr = mytable.getElementsByTagName('tr');
             for(var i=0; i<tr.length; i++){
                let td = tr[i].getElementsByTagName('td')[1];
                if(td){
                    let textvalue = td.textContent || td.innerHTML;
                    if(textvalue.toUpperCase().indexOf(filter) > -1){
                        tr[i].style.display="";
                    }else{
                        tr[i].style.display = "none";
                    }
                }
             }
           }
    function handleAddPlan(){
        $('#page').addClass('opacity-30');
        $('#add-plan').removeClass('hidden');
    }
    function handleAddUserCrossClick() {
        $('#page').removeClass('opacity-30');
        $('#add-plan').addClass('hidden');
    }       
    function onPlanSubmit(){
        $('#loader').removeClass('hidden');
        const body_data = {
            plan_name : $('input[name=plan-name]').val(),
            plan_interval :$('input[name=interval]').val(),
            plan_amount : $('input[name=amount]').val(),
            plan_currency : $('input[name=currency]').val(),
            period : $('select[name=period]').val(),
            plan_type : $('select[name=plan-type]').val()
        };
        $.post('/admin/plan',body_data,(res)=>{
            $('#loader').addClass('hidden');
            $('#add-plan').addClass('hidden');
            $("#response").removeClass("hidden");
            if(res === "success")
                $("input[name=response").val("Successfully Added!").addClass("text-emerald-400");
            else 
                $('#input[name=response]').val("Something went wrong! Try again later").addClass("text-red-400");    
        });
    }
    function handleStatusCrossClick (){
        $("#page").removeClass('opacity-30');
        $("#response").addClass('hidden');
    }       
 </script>
<%- include('partials/footer')%>
